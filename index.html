<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Study Music Library</title>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <header>
    <div class="container">
      <h1>Study Music Library</h1>
      <button id="darkToggle" class="icon-btn" title="Toggle dark mode">üåô</button>
    </div>
    <div class="container" id="topTools">
      <input id="searchBox" type="search" placeholder="Search tracks‚Ä¶" />
      <select id="sortSelect">
        <option value="alpha">Title A‚ÜíZ</option>
        <option value="alpha-desc">Title Z‚ÜíA</option>
        <option value="subject">By Subject</option>
      </select>
    </div>
  </header>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <main class="container">
    <div id="filters"></div>
    <div id="tracks"></div>
  </main>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ FOOTER / CUSTOM PLAYER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <footer>
    <div class="container">
      <button id="playPause" title="Play/Pause">‚ñ∂Ô∏è</button>
      <span class="time" id="currentTime">0:00</span>
      <div id="progressBar"><div id="progressFill"></div></div>
      <span class="time" id="totalTime">0:00</span>
      <button id="loopToggle" title="Toggle loop">üîÅ</button>
      <input id="volumeRange" type="range" min="0" max="1" step="0.05" value="1" title="Volume" />
      <select id="speedSelect" title="Speed">
        <option value="0.75">0.75√ó</option>
        <option value="1" selected>1√ó</option>
        <option value="1.25">1.25√ó</option>
        <option value="1.5">1.5√ó</option>
      </select>
    </div>
  </footer>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ LOGIC ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <script>
    /* -------- Dark‚Äëmode toggle -------- */
    const darkToggle = document.getElementById('darkToggle');
    darkToggle.onclick = () => {
      document.documentElement.classList.toggle('dark');
      localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
    };
    if (localStorage.theme === 'dark') document.documentElement.classList.add('dark');

    /* -------- Elements -------- */
    const player = new Audio();
    const playBtn   = document.getElementById('playPause');
    const loopBtn   = document.getElementById('loopToggle');
    const progBar   = document.getElementById('progressBar');
    const progFill  = document.getElementById('progressFill');
    const curTimeEl = document.getElementById('currentTime');
    const totTimeEl = document.getElementById('totalTime');

    // volume & speed
    document.getElementById('volumeRange').oninput = e => player.volume = e.target.value;
    document.getElementById('speedSelect').oninput = e => player.playbackRate = parseFloat(e.target.value);

    // play / pause toggle
    playBtn.onclick = () => {
      if (player.src) {
        player.paused ? player.play() : player.pause();
      }
    };
    player.onplay  = () => playBtn.textContent = '‚è∏Ô∏è';
    player.onpause = () => playBtn.textContent = '‚ñ∂Ô∏è';

    // loop toggle
    loopBtn.onclick = () => {
      player.loop = !player.loop;
      loopBtn.classList.toggle('active', player.loop);
    };

    // progress bar update
    player.ontimeupdate = () => {
      const pct = (player.currentTime / player.duration) * 100;
      progFill.style.width = pct + '%';
      curTimeEl.textContent = formatTime(player.currentTime);
    };
    player.onloadedmetadata = () => {
      totTimeEl.textContent = formatTime(player.duration);
    };
    progBar.onclick = e => {
      const rect = progBar.getBoundingClientRect();
      const pct = (e.clientX - rect.left) / rect.width;
      player.currentTime = pct * player.duration;
    };

    // keyboard shortcuts
    document.addEventListener('keydown', e => {
      if (e.target.matches('input, select')) return; // ignore form inputs
      if (e.code === 'Space') { e.preventDefault(); playBtn.click(); }
      if (e.key.toLowerCase() === 'l') loopBtn.click();
      if (e.code === 'ArrowRight') player.currentTime = Math.min(player.duration, player.currentTime + 5);
      if (e.code === 'ArrowLeft')  player.currentTime = Math.max(0, player.currentTime - 5);
    });

    /* -------- Track catalogue -------- */
    const tracks = [
      { title: 'Math Focus Beats',  subject: 'Maths',   url: 'focus-beats.mp3', added: '2025-06-01' },
      { title: 'English Lock‚ÄëIn',   subject: 'English', url: 'SUPER FOCUS [ Flow State Music ] Binaural Beats 40Hz ‚òÖ Ambient Study Music to Concentrate (mp3cut.net).mp3', added: '2025-07-01' }
    ];
    // store metadata durations
    const durationCache = {};

    /* -------- Render helpers -------- */
    const filtersEl = document.getElementById('filters');
    const tracksEl  = document.getElementById('tracks');
    const searchBox = document.getElementById('searchBox');
    const sortSel   = document.getElementById('sortSelect');

    searchBox.oninput = renderList;
    sortSel.onchange  = renderList;

    function buildFilters() {
      filtersEl.innerHTML = '';
      const allBtn = makeFilterBtn('All');
      allBtn.classList.add('active');
      filtersEl.appendChild(allBtn);
      ;[...new Set(tracks.map(t => t.subject))].forEach(sub => filtersEl.appendChild(makeFilterBtn(sub)));
    }
    function makeFilterBtn(text) {
      const btn = document.createElement('button');
      btn.textContent = text;
      btn.className = 'filter-btn';
      btn.onclick = () => {
        document.querySelectorAll('#filters .filter-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        renderList();
      };
      return btn;
    }

    function renderList() {
      const activeFilter = document.querySelector('#filters .filter-btn.active')?.textContent;
      const q = searchBox.value.toLowerCase();
      let list = tracks.filter(t => (!activeFilter || activeFilter==='All' || t.subject===activeFilter) && t.title.toLowerCase().includes(q));
      switch(sortSel.value){
        case 'alpha':      list.sort((a,b)=>a.title.localeCompare(b.title)); break;
        case 'alpha-desc': list.sort((a,b)=>b.title.localeCompare(a.title)); break;
        case 'subject':    list.sort((a,b)=>a.subject.localeCompare(b.subject)||a.title.localeCompare(b.title)); break;
      }
      tracksEl.innerHTML='';
      list.forEach(track=>tracksEl.appendChild(buildCard(track)));
    }

    function buildCard(track){
      const card = document.createElement('div');
      card.className='card';
      card.innerHTML=`<div class="card-progress" id="prog-${track.title}"></div>
        <h3 class="card-title">${track.title}</h3>
        <p class="card-sub">${track.subject}</p>
        <p class="card-duration" id="dur-${track.title}">--:--</p>
        <button class="play-btn">‚ñ∂Ô∏è Play</button>`;
      const btn = card.querySelector('button');
      btn.onclick = ()=>{
        playTrack(track, card);
      };
      // fetch duration once
      if(!durationCache[track.url]){
        const tmp=new Audio(track.url);
        tmp.onloadedmetadata=()=>{
          durationCache[track.url]=tmp.duration;
          card.querySelector(`#dur-${track.title}`).textContent=formatTime(tmp.duration);
        };
      }else{
        card.querySelector(`#dur-${track.title}`).textContent=formatTime(durationCache[track.url]);
      }
      return card;
    }

    function playTrack(track, card){
      player.src=track.url;
      player.play();
      document.querySelectorAll('.card-progress').forEach(el=>el.style.width='0%');
      player.ontimeupdate=()=>{
        const pct=(player.currentTime/player.duration)*100;
        card.querySelector('.card-progress').style.width=pct+'%';
        curTimeEl.textContent=formatTime(player.currentTime);
        totTimeEl.textContent=formatTime(player.duration);
        progFill.style.width=pct+'%';
      };
    }

    function formatTime(sec){
      if(!sec||isNaN(sec))return '0:00';
      const m=Math.floor(sec/60);
      const s=Math.floor(sec%60).toString().padStart(2,'0');
      return `${m}:${s}`;
    }

    buildFilters();
    renderList();
  </script>
</body>
</html>
