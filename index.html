<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StudyÂ MusicÂ Library</title>
  <!-- TailwindÂ via CDN (no build step needed) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Darkâ€‘mode colours -->
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>
</head>
<body class="bgâ€‘grayâ€‘100 dark:bgâ€‘grayâ€‘900 minâ€‘hâ€‘screen flex flexâ€‘col textâ€‘grayâ€‘900 dark:textâ€‘grayâ€‘100">
  <!-- Header -->
  <header class="bgâ€‘indigoâ€‘600 dark:bgâ€‘indigoâ€‘700 textâ€‘white shadow pâ€‘4">
    <div class="container mxâ€‘auto flex itemsâ€‘center gapâ€‘4">
      <h1 class="textâ€‘2xl fontâ€‘semibold">StudyÂ MusicÂ Library</h1>
      <button id="darkToggle" class="mlâ€‘auto pâ€‘2 roundedâ€‘lg border borderâ€‘white/30 hover:bgâ€‘white/10" title="Toggle dark mode">ðŸŒ™</button>
    </div>
  </header>

  <!-- Main -->
  <main class="flexâ€‘1 container mxâ€‘auto pâ€‘4">
    <!-- Upload & subject selector -->
    <div class="flex flexâ€‘wrap gapâ€‘4 itemsâ€‘center mbâ€‘6">
      <label class="block">
        <span class="srâ€‘only">Upload MP3s</span>
        <input type="file" id="uploader" accept="audio/mp3" multiple class="file:mrâ€‘4 file:pyâ€‘2 file:pxâ€‘4 file:borderâ€‘0 file:textâ€‘sm file:bgâ€‘indigoâ€‘50 file:textâ€‘indigoâ€‘700 hover:file:bgâ€‘indigoâ€‘100 cursorâ€‘pointer" />
      </label>
      <select id="subjectSelect" class="border roundedâ€‘lg pâ€‘2 bgâ€‘white dark:bgâ€‘grayâ€‘800 dark:borderâ€‘grayâ€‘700">
        <option value="">Choose subject</option>
        <option>Maths</option>
        <option>Physics</option>
        <option>Chemistry</option>
        <option>Languages</option>
        <option>Other</option>
      </select>
    </div>

    <!-- Dynamic subject filter buttons -->
    <div id="filters" class="flex flexâ€‘wrap gapâ€‘2 mbâ€‘4"></div>

    <!-- Track cards grid -->
    <div id="tracks" class="grid gridâ€‘colsâ€‘1 sm:gridâ€‘colsâ€‘2 lg:gridâ€‘colsâ€‘3 gapâ€‘6"></div>
  </main>

  <!-- Sticky footer player -->
  <footer class="bgâ€‘white dark:bgâ€‘grayâ€‘800 borderâ€‘t dark:borderâ€‘grayâ€‘700 shadowâ€‘inner pâ€‘4 sticky bottomâ€‘0">
    <div class="container mxâ€‘auto flex itemsâ€‘center gapâ€‘4">
      <audio id="player" controls class="flexâ€‘1 wâ€‘full"></audio>
      <label class="textâ€‘sm flex itemsâ€‘center gapâ€‘1">
        Speed
        <select id="speedSelect" class="border roundedâ€‘md pâ€‘1 bgâ€‘white dark:bgâ€‘grayâ€‘700 dark:borderâ€‘grayâ€‘600 textâ€‘sm">
          <option value="0.75">0.75Ã—</option>
          <option value="1" selected>1Ã—</option>
          <option value="1.25">1.25Ã—</option>
          <option value="1.5">1.5Ã—</option>
        </select>
      </label>
    </div>
  </footer>

  <!-- Main logic -->
  <script>
  // ======Â ThemeÂ toggleÂ ======
  const darkToggle = document.getElementById('darkToggle');
  darkToggle.addEventListener('click', () => {
    document.documentElement.classList.toggle('dark');
    localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
  });
  if (localStorage.theme === 'dark') document.documentElement.classList.add('dark');

  // ======Â AudioÂ playerÂ controlsÂ ======
  const player = document.getElementById('player');
  document.getElementById('speedSelect').addEventListener('change', e => {
    player.playbackRate = parseFloat(e.target.value);
  });

  // ======Â TrackÂ dataÂ ======
  let tracks = [];

  async function loadRemoteList() {
    try {
      const res = await fetch('tracks.json');
      if (res.ok) {
        tracks = await res.json();
      }
    } catch (err) {
      console.info('No remote track list found â€“ starting empty.');
    }
    render();
  }
  loadRemoteList();

  // ======Â LocalÂ fileÂ uploadsÂ ======
  const uploader = document.getElementById('uploader');
  uploader.addEventListener('change', e => {
    const subject = document.getElementById('subjectSelect').value || 'Uncategorised';
    [...e.target.files].forEach(file => {
      const url = URL.createObjectURL(file);
      tracks.push({ title: file.name.replace(/\.mp3$/i, ''), subject, url, local: true });
    });
    render();
    uploader.value = '';
  });

  // ======Â UIÂ helpersÂ ======
  function render() {
    const filtersEl = document.getElementById('filters');
    const tracksEl = document.getElementById('tracks');
    filtersEl.innerHTML = '';
    tracksEl.innerHTML = '';

    const subjects = [...new Set(tracks.map(t => t.subject))];
    subjects.forEach(sub => {
      const btn = document.createElement('button');
      btn.textContent = sub;
      btn.className = 'pxâ€‘3 pyâ€‘1 roundedâ€‘full border borderâ€‘indigoâ€‘600 dark:borderâ€‘indigoâ€‘400 textâ€‘indigoâ€‘600 dark:textâ€‘indigoâ€‘300 hover:bgâ€‘indigoâ€‘600 hover:textâ€‘white textâ€‘sm';
      btn.addEventListener('click', () => showSubject(sub));
      filtersEl.appendChild(btn);
    });

    showSubject();
  }

  function showSubject(filter) {
    const tracksEl = document.getElementById('tracks');
    tracksEl.innerHTML = '';

    tracks.filter(t => !filter || t.subject === filter).forEach(track => {
      const card = document.createElement('div');
      card.className = 'bgâ€‘white dark:bgâ€‘grayâ€‘700 roundedâ€‘xl shadow pâ€‘4 flex flexâ€‘col';
      card.innerHTML = `
        <h3 class="fontâ€‘semibold mbâ€‘1 truncate">${track.title}</h3>
        <p class="textâ€‘xs textâ€‘grayâ€‘500 dark:textâ€‘grayâ€‘300 mbâ€‘4">${track.subject}</p>
        <button class="mtâ€‘auto pxâ€‘3 pyâ€‘2 roundedâ€‘lg bgâ€‘indigoâ€‘600 hover:bgâ€‘indigoâ€‘700 textâ€‘white wâ€‘full">Play</button>
        <a class="mtâ€‘2 textâ€‘xs textâ€‘indigoâ€‘500 hover:underline ${track.local ? 'hidden' : ''}" href="${track.url || ''}" download>Download</a>`;

      const playBtn = card.querySelector('button');
      playBtn.addEventListener('click', () => {
        player.src = track.url;
        player.play();
      });
      tracksEl.appendChild(card);
    });
  }
  </script>
</body>
</html>

