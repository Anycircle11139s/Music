<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Study Music Library</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 min-h-screen flex flex-col text-gray-900 dark:text-gray-100">
  <header class="bg-indigo-600 dark:bg-indigo-700 text-white shadow p-4">
    <div class="container mx-auto flex items-center gap-4">
      <h1 class="text-2xl font-semibold">Study Music Library</h1>
      <button id="darkToggle" class="ml-auto p-2 rounded-lg border border-white/30 hover:bg-white/10" title="Toggle dark mode">ðŸŒ™</button>
    </div>
  </header>

  <main class="flex-1 container mx-auto p-4">
    <div class="flex flex-wrap gap-4 items-center mb-6">
      <label class="block">
        <span class="sr-only">Upload MP3s</span>
        <input type="file" id="uploader" accept="audio/mp3" multiple class="file:mr-4 file:py-2 file:px-4 file:border-0 file:text-sm file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 cursor-pointer" />
      </label>
      <select id="subjectSelect" class="border rounded-lg p-2 bg-white dark:bg-gray-800 dark:border-gray-700">
        <option value="">Choose subject</option>
        <option>Maths</option>
        <option>Physics</option>
        <option>Chemistry</option>
        <option>Languages</option>
        <option>Other</option>
      </select>
    </div>

    <div id="filters" class="flex flex-wrap gap-2 mb-4"></div>
    <div id="tracks" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
  </main>

  <footer class="bg-white dark:bg-gray-800 border-t dark:border-gray-700 shadow-inner p-4 sticky bottom-0">
    <div class="container mx-auto flex items-center gap-4">
      <audio id="player" controls class="flex-1 w-full"></audio>
      <label class="text-sm flex items-center gap-1">
        Speed
        <select id="speedSelect" class="border rounded-md p-1 bg-white dark:bg-gray-700 dark:border-gray-600 text-sm">
          <option value="0.75">0.75Ã—</option>
          <option value="1" selected>1Ã—</option>
          <option value="1.25">1.25Ã—</option>
          <option value="1.5">1.5Ã—</option>
        </select>
      </label>
    </div>
  </footer>

  <script>
    const darkToggle = document.getElementById('darkToggle');
    darkToggle.addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
      localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
    });
    if (localStorage.theme === 'dark') document.documentElement.classList.add('dark');

    const player = document.getElementById('player');
    document.getElementById('speedSelect').addEventListener('change', e => {
      player.playbackRate = parseFloat(e.target.value);
    });

    let tracks = [];

    const uploader = document.getElementById('uploader');
    uploader.addEventListener('change', e => {
      const subject = document.getElementById('subjectSelect').value || 'Uncategorised';
      [...e.target.files].forEach(file => {
        const url = URL.createObjectURL(file);
        tracks.push({ title: file.name.replace(/\.mp3$/i, ''), subject, url, local: true });
      });
      render();
      uploader.value = '';
    });

    function render() {
      const filtersEl = document.getElementById('filters');
      const tracksEl = document.getElementById('tracks');
      filtersEl.innerHTML = '';
      tracksEl.innerHTML = '';

      const subjects = [...new Set(tracks.map(t => t.subject))];
      subjects.forEach(sub => {
        const btn = document.createElement('button');
        btn.textContent = sub;
        btn.className = 'px-3 py-1 rounded-full border border-indigo-600 dark:border-indigo-400 text-indigo-600 dark:text-indigo-300 hover:bg-indigo-600 hover:text-white text-sm';
        btn.addEventListener('click', () => showSubject(sub));
        filtersEl.appendChild(btn);
      });

      showSubject();
    }

    function showSubject(filter) {
      const tracksEl = document.getElementById('tracks');
      tracksEl.innerHTML = '';

      tracks.filter(t => !filter || t.subject === filter).forEach(track => {
        const card = document.createElement('div');
        card.className = 'bg-white dark:bg-gray-700 rounded-xl shadow p-4 flex flex-col';
        card.innerHTML = `
          <h3 class="font-semibold mb-1 truncate">${track.title}</h3>
          <p class="text-xs text-gray-500 dark:text-gray-300 mb-4">${track.subject}</p>
          <button class="mt-auto px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white w-full">Play</button>
        `;

        const playBtn = card.querySelector('button');
        playBtn.addEventListener('click', () => {
          player.src = track.url;
          player.play();
        });
        tracksEl.appendChild(card);
      });
    }
  </script>
</body>
</html>
